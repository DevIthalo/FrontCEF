!function(){"use strict";var e,t=tinymce.util.Tools.resolve("tinymce.PluginManager");let o=e=>t=>e===t,r=o(null),n=o(void 0),s=()=>{},l=()=>!1;class a{constructor(e,t){this.tag=e,this.value=t}static some(e){return new a(!0,e)}static none(){return a.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?a.some(e(this.value)):a.none()}bind(e){return this.tag?e(this.value):a.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:a.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?a.none():a.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}a.singletonNone=new a(!1);let i=(e,t)=>{let o=e.length,r=Array(o);for(let n=0;n<o;n++){let o=e[n];r[n]=t(o,n)}return r},u=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},c=Object.keys,g=Object.hasOwnProperty,m=(e,t)=>{let o=c(e);for(let r=0,n=o.length;r<n;r++){let n=o[r];t(e[n],n)}},d=(e,t)=>g.call(e,t),h=(e=(e,t)=>t,(...t)=>{if(0===t.length)throw Error("Can't merge zero objects");let o={};for(let r=0;r<t.length;r++){let n=t[r];for(let t in n)d(n,t)&&(o[t]=e(o[t],n[t]))}return o}),p=()=>{let e=(e=>{let t=u(a.none()),o=()=>t.get().each(e);return{clear:()=>{o(),t.set(a.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{o(),t.set(a.some(e))}}})(s);return{...e,on:t=>e.get().each(t)}},y=(e,t,o=0,r)=>{let s=e.indexOf(t,o);return -1!==s&&(!!n(r)||s+t.length<=r)};var v=tinymce.util.Tools.resolve("tinymce.Resource");let f=e=>t=>t.options.get(e),b=f("emoticons_database"),C=f("emoticons_database_url"),_=f("emoticons_database_id"),w=f("emoticons_append"),j=f("emoticons_images_url"),A={symbols:"Symbols",people:"People",animals_and_nature:"Animals and Nature",food_and_drink:"Food and Drink",activity:"Activity",travel_and_places:"Travel and Places",objects:"Objects",flags:"Flags",user:"User Defined"},k=(e,t)=>d(e,t)?e[t]:t,O=e=>{var t;let o=w(e);return t=e=>({keywords:[],category:"user",...e}),((e,t)=>{let o={};return m(e,(e,r)=>{let n=t(e,r);o[n.k]=n.v}),o})(o,(e,o)=>({k:o,v:t(e)}))},x=(e,t)=>y(e.title.toLowerCase(),t)||((e,o)=>{for(let o=0,r=e.length;o<r;o++)if(y(e[o].toLowerCase(),t))return!0;return!1})(e.keywords),E=(e,t,o)=>{let r=[],n=t.toLowerCase(),s=o.fold(()=>l,e=>t=>t>=e);for(let o=0;o<e.length&&(0!==t.length&&!x(e[o],n)||(r.push({value:e[o].char,text:e[o].title,icon:e[o].char}),!s(r.length)));o++);return r},S="pattern",L=(e,t)=>{let o={pattern:"",results:E(t.listAll(),"",a.some(300))},n=u("All"),s=((e,t)=>{let o=null,n=()=>{r(o)||(clearTimeout(o),o=null)};return{cancel:n,throttle:(...t)=>{n(),o=setTimeout(()=>{o=null,e.apply(null,t)},200)}}})(e=>{(e=>{let o=n.get(),r=t.listCategory(o),s=E(r,e.getData()[S],"All"===o?a.some(300):a.none());e.setData({results:s})})(e)}),l={label:"Search",type:"input",name:S},c={type:"collection",name:"results"},g=()=>({title:"Emojis",size:"normal",body:{type:"tabpanel",tabs:i(t.listCategories(),e=>({title:e,name:e,items:[l,c]}))},initialData:o,onTabChange:(e,t)=>{n.set(t.newTabName),s.throttle(e)},onChange:s.throttle,onAction:(t,o)=>{"results"===o.name&&(((e,t)=>{e.insertContent(t)})(e,o.value),t.close())},buttons:[{type:"cancel",text:"Close",primary:!0}]}),m=e.windowManager.open(g());m.focus(S),t.hasLoaded()||(m.block("Loading emojis..."),t.waitForLoad().then(()=>{m.redial(g()),s.throttle(m),m.focus(S),m.unblock()}).catch(e=>{m.redial({title:"Emojis",body:{type:"panel",items:[{type:"alertbanner",level:"error",icon:"warning",text:"Could not load emojis"}]},buttons:[{type:"cancel",text:"Close",primary:!0}],initialData:{pattern:"",results:[]}}),m.focus(S),m.unblock()}))},N=e=>t=>{let o=()=>{t.setEnabled(e.selection.isEditable())};return e.on("NodeChange",o),o(),()=>{e.off("NodeChange",o)}};t.add("emoticons",(e,t)=>{((e,t)=>{let o=e.options.register;o("emoticons_database",{processor:"string",default:"emojis"}),o("emoticons_database_url",{processor:"string",default:`${t}/js/${b(e)}${e.suffix}.js`}),o("emoticons_database_id",{processor:"string",default:"tinymce.plugins.emoticons"}),o("emoticons_append",{processor:"object",default:{}}),o("emoticons_images_url",{processor:"string",default:"https://twemoji.maxcdn.com/v/13.0.1/72x72/"})})(e,t);let o=((e,t,o)=>{let r=p(),n=p(),s=j(e),l=e=>{var t;return(t=e.char).length>=4&&"<img"===t.substr(0,4)?e.char.replace(/src="([^"]+)"/,(e,t)=>`src="${s}${t}"`):e.char};e.on("init",()=>{v.load(o,t).then(t=>{let o=O(e);(e=>{let t={},o=[];m(e,(e,r)=>{let n={title:r,keywords:e.keywords,char:l(e),category:k(A,e.category)},s=void 0!==t[n.category]?t[n.category]:[];t[n.category]=s.concat([n]),o.push(n)}),r.set(t),n.set(o)})(h(t,o))},e=>{console.log(`Failed to load emojis: ${e}`),r.set({}),n.set([])})});let i=()=>n.get().getOr([]),u=()=>r.isSet()&&n.isSet();return{listCategories:()=>["All"].concat(c(r.get().getOr({}))),hasLoaded:u,waitForLoad:()=>u()?Promise.resolve(!0):new Promise((e,o)=>{let r=15,n=setInterval(()=>{u()?(clearInterval(n),e(!0)):--r<0&&(console.log("Could not load emojis from url: "+t),clearInterval(n),o(!1))},100)}),listAll:i,listCategory:e=>"All"===e?i():r.get().bind(t=>a.from(t[e])).getOr([])}})(e,C(e),_(e));((e,t)=>{e.addCommand("mceEmoticons",()=>L(e,t))})(e,o),(e=>{let t=()=>e.execCommand("mceEmoticons");e.ui.registry.addButton("emoticons",{tooltip:"Emojis",icon:"emoji",onAction:t,onSetup:N(e)}),e.ui.registry.addMenuItem("emoticons",{text:"Emojis...",icon:"emoji",onAction:t,onSetup:N(e)})})(e),((e,t)=>{e.ui.registry.addAutocompleter("emoticons",{trigger:":",columns:"auto",minChars:2,fetch:(e,o)=>t.waitForLoad().then(()=>{let r=t.listAll();return E(r,e,a.some(o))}),onAction:(t,o,r)=>{e.selection.setRng(o),e.insertContent(r),t.hide()}})})(e,o),(e=>{e.on("PreInit",()=>{e.parser.addAttributeFilter("data-emoticon",e=>{((e,t)=>{var o;for(let t=0,r=e.length;t<r;t++)(o=e[t]).attr("data-mce-resize","false"),o.attr("data-mce-placeholder","1")})(e)})})})(e)})}();