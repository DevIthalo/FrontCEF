!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>"string"===(e=>{var t,r;let a=typeof e;return null===e?"null":"object"===a&&Array.isArray(e)?"array":"object"===a&&((t=String).prototype.isPrototypeOf(e)||(null===(r=e.constructor)||void 0===r?void 0:r.name)===t.name)?"string":a})(e),r=e=>void 0===e;var a=tinymce.util.Tools.resolve("tinymce.util.Delay"),o=tinymce.util.Tools.resolve("tinymce.util.LocalStorage"),s=tinymce.util.Tools.resolve("tinymce.util.Tools");let n=e=>{let t=/^(\d+)([ms]?)$/.exec(e);return(t&&t[2]?({s:1e3,m:6e4})[t[2]]:1)*parseInt(e,10)},i=e=>t=>t.options.get(e),l=i("autosave_ask_before_unload"),u=i("autosave_restore_when_empty"),m=i("autosave_interval"),d=i("autosave_retention"),v=e=>{let t=document.location;return e.options.get("autosave_prefix").replace(/{path}/g,t.pathname).replace(/{query}/g,t.search).replace(/{hash}/g,t.hash).replace(/{id}/g,e.id)},f=(e,t)=>{if(r(t))return e.dom.isEmpty(e.getBody());{let r=s.trim(t);if(""===r)return!0;{let t=(new DOMParser).parseFromString(r,"text/html");return e.dom.isEmpty(t)}}},c=e=>{var t;let r=parseInt(null!==(t=o.getItem(v(e)+"time"))&&void 0!==t?t:"0",10)||0;return!((new Date).getTime()-r>d(e)&&(p(e,!1),1))},p=(e,t)=>{let r=v(e);o.removeItem(r+"draft"),o.removeItem(r+"time"),!1!==t&&(e=>{e.dispatch("RemoveDraft")})(e)},g=e=>{let t=v(e);!f(e)&&e.isDirty()&&(o.setItem(t+"draft",e.getContent({format:"raw",no_events:!0})),o.setItem(t+"time",(new Date).getTime().toString()),(e=>{e.dispatch("StoreDraft")})(e))},y=e=>{var t;let r=v(e);c(e)&&(e.setContent(null!==(t=o.getItem(r+"draft"))&&void 0!==t?t:"",{format:"raw"}),(e=>{e.dispatch("RestoreDraft")})(e))};var D=tinymce.util.Tools.resolve("tinymce.EditorManager");let h=e=>t=>{t.setEnabled(c(e));let r=()=>t.setEnabled(c(e));return e.on("StoreDraft RestoreDraft RemoveDraft",r),()=>e.off("StoreDraft RestoreDraft RemoveDraft",r)};e.add("autosave",e=>((e=>{let r=e.options.register,a=e=>{let r=t(e);return r?{value:n(e),valid:r}:{valid:!1,message:"Must be a string."}};r("autosave_ask_before_unload",{processor:"boolean",default:!0}),r("autosave_prefix",{processor:"string",default:"tinymce-autosave-{path}{query}{hash}-{id}-"}),r("autosave_restore_when_empty",{processor:"boolean",default:!1}),r("autosave_interval",{processor:a,default:"30s"}),r("autosave_retention",{processor:a,default:"20m"})})(e),(e=>{e.editorManager.on("BeforeUnload",e=>{let t;s.each(D.get(),e=>{e.plugins.autosave&&e.plugins.autosave.storeDraft(),!t&&e.isDirty()&&l(e)&&(t=e.translate("You have unsaved changes are you sure you want to navigate away?"))}),t&&(e.preventDefault(),e.returnValue=t)})})(e),(e=>{(e=>{let t=m(e);a.setEditorInterval(e,()=>{g(e)},t)})(e);let t=()=>{e.undoManager.transact(()=>{y(e),p(e)}),e.focus()};e.ui.registry.addButton("restoredraft",{tooltip:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:h(e)}),e.ui.registry.addMenuItem("restoredraft",{text:"Restore last draft",icon:"restore-draft",onAction:t,onSetup:h(e)})})(e),e.on("init",()=>{u(e)&&e.dom.isEmpty(e.getBody())&&y(e)}),{hasDraft:()=>c(e),storeDraft:()=>g(e),restoreDraft:()=>y(e),removeDraft:t=>p(e,t),isEmpty:t=>f(e,t)}))}();