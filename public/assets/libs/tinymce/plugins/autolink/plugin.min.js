!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>t=>t.options.get(e),r=t("autolink_pattern"),n=t("link_default_target"),o=t("link_default_protocol"),l=t("allow_unsafe_link_target"),a=e=>"string"===(e=>{var t,r;let n=typeof e;return null===e?"null":"object"===n&&Array.isArray(e)?"array":"object"===n&&((t=String).prototype.isPrototypeOf(e)||(null===(r=e.constructor)||void 0===r?void 0:r.name)===t.name)?"string":n})(e),i=e=>void 0===e,s=e=>null!=e,d=Object.hasOwnProperty,u=e=>"\uFEFF"===e;var c=tinymce.util.Tools.resolve("tinymce.dom.TextSeeker");let g=e=>/^[(\[{ \u00a0]$/.test(e),f=(e,t,r)=>{for(let n=t-1;n>=0;n--){let t=e.charAt(n);if(!u(t)&&r(t))return n}return -1},m=(e,t)=>{var n,l,a;let s=e.schema.getVoidElements(),u=r(e),{dom:m,selection:k}=e;if(null!==m.getParent(k.getNode(),"a[href]"))return null;let p=k.getRng(),y=c(m,e=>{var t;return m.isBlock(e)||(t=e.nodeName.toLowerCase(),d.call(s,t))||"false"===m.getContentEditable(e)}),{container:w,offset:h}=((e,t)=>{let r=e,n=t;for(;1===r.nodeType&&r.childNodes[n];)n=3===(r=r.childNodes[n]).nodeType?r.data.length:r.childNodes.length;return{container:r,offset:n}})(p.endContainer,p.endOffset),v=null!==(n=m.getParent(w,m.isBlock))&&void 0!==n?n:m.getRoot(),_=y.backwards(w,h+t,(e,t)=>{var r;let n=e.data,o=f(n,t,e=>!g(e));return -1===o||(r=n[o],/[?!,.;:]/.test(r))?o:o+1},v);if(!_)return null;let A=_.container,C=y.backwards(_.container,_.offset,(e,t)=>{A=e;let r=f(e.data,t,g);return -1===r?r:r+1},v),b=m.createRng();C?b.setStart(C.container,C.offset):b.setStart(A,0),b.setEnd(_.container,_.offset);let E=b.toString().replace(/\uFEFF/g,"").match(u);if(E){let t=E[0];return(l=t).length>=4&&"www."===l.substr(0,4)?t=o(e)+"://"+t:((e,t,r=0,n)=>{let o=e.indexOf(t,r);return -1!==o&&(!!i(n)||o+t.length<=n)})(t,"@")&&(a=t,!/^([A-Za-z][A-Za-z\d.+-]*:\/\/)|mailto:/.test(a))&&(t="mailto:"+t),{rng:b,url:t}}return null},k=(e,t)=>{let{dom:r,selection:o}=e,{rng:i,url:s}=t,d=o.getBookmark();o.setRng(i);let u="createlink",c={command:u,ui:!1,value:s};if(!e.dispatch("BeforeExecCommand",c).isDefaultPrevented()){e.getDoc().execCommand(u,!1,s),e.dispatch("ExecCommand",c);let t=n(e);if(a(t)){let n=o.getNode();r.setAttrib(n,"target",t),"_blank"!==t||l(e)||r.setAttrib(n,"rel","noopener")}}o.moveToBookmark(d),e.nodeChanged()},p=e=>{let t=m(e,-1);s(t)&&k(e,t)};e.add("autolink",e=>{(e=>{let t=e.options.register;t("autolink_pattern",{processor:"regexp",default:RegExp("^"+/(?:[A-Za-z][A-Za-z\d.+-]{0,14}:\/\/(?:[-.~*+=!&;:'%@?^${}(),\w]+@)?|www\.|[-;:&=+$,.\w]+@)[A-Za-z\d-]+(?:\.[A-Za-z\d-]+)*(?::\d+)?(?:\/(?:[-.~*+=!;:'%@$(),\/\w]*[-~*+=%@$()\/\w])?)?(?:\?(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?(?:#(?:[-.~*+=!&;:'%@?^${}(),\/\w]+))?/g.source+"$","i")}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"})})(e),e.on("keydown",t=>{13!==t.keyCode||t.isDefaultPrevented()||(e=>{let t=m(e,0);s(t)&&k(e,t)})(e)}),e.on("keyup",t=>{32===t.keyCode?p(e):(48===t.keyCode&&t.shiftKey||221===t.keyCode)&&p(e)})})}();