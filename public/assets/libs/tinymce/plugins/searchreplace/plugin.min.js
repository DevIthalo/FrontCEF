!function(){"use strict";let e=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}};var t=tinymce.util.Tools.resolve("tinymce.PluginManager");let n=e=>t=>(e=>{var t,n;let r=typeof e;return null===e?"null":"object"===r&&Array.isArray(e)?"array":"object"===r&&((t=String).prototype.isPrototypeOf(e)||(null===(n=e.constructor)||void 0===n?void 0:n.name)===t.name)?"string":r})(t)===e,r=e=>t=>typeof t===e,l=n("string"),a=n("array"),o=r("boolean"),s=r("number"),i=()=>{},d=e=>()=>e,c=d(!0),u=d("[~№|!-*+-\\/:;?@\\[-`{}\xa1\xab\xb7\xbb\xbf;\xb7՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾࡞।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔࿙࿚၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᨞᨟᪠-᪦᪨-᪭᭚-᭠᯼-᯿᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⵰⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･]");class h{constructor(e,t){this.tag=e,this.value=t}static some(e){return new h(!0,e)}static none(){return h.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?h.some(e(this.value)):h.none()}bind(e){return this.tag?e(this.value):h.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:h.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?h.none():h.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}h.singletonNone=new h(!1);var m=tinymce.util.Tools.resolve("tinymce.Env"),g=tinymce.util.Tools.resolve("tinymce.util.Tools");let f=Array.prototype.slice,p=Array.prototype.push,x=(e,t)=>{let n=e.length,r=Array(n);for(let l=0;l<n;l++){let n=e[l];r[l]=t(n,l)}return r},y=(e,t)=>{for(let n=0,r=e.length;n<r;n++)t(e[n],n)},b=(e,t)=>{for(let n=e.length-1;n>=0;n--)t(e[n],n)},v=(e,t)=>(e=>{let t=[];for(let n=0,r=e.length;n<r;++n){if(!a(e[n]))throw Error("Arr.flatten item "+n+" was not an array, input: "+e);p.apply(t,e[n])}return t})(x(e,t)),w=Object.hasOwnProperty,C=(e,t)=>w.call(e,t);"undefined"!=typeof window?window:Function("return this;")();let E=e=>{if(null==e)throw Error("Node cannot be null or undefined");return{dom:e}},O=(e,t)=>({element:e,offset:t}),N=(e,t)=>{((e,t)=>{let n=h.from(e.dom.parentNode).map(E);n.each(n=>{n.dom.insertBefore(t.dom,e.dom)})})(e,t),((e,t)=>{e.dom.appendChild(t.dom)})(t,e)},T=((e,t)=>{let n=t=>e(t)?h.from(t.dom.nodeValue):h.none();return{get:t=>{if(!e(t))throw Error("Can only get text value of a text node");return n(t).getOr("")},getOption:n,set:(t,n)=>{if(!e(t))throw Error("Can only set raw text value of a text node");t.dom.nodeValue=n}}})(e=>3===e.dom.nodeType),k=e=>T.get(e);var A=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker");let S=(e,t)=>e.isBlock(t)||C(e.schema.getVoidElements(),t.nodeName),B=(e,t)=>"false"===e.getContentEditable(t),F=(e,t)=>!e.isBlock(t)&&C(e.schema.getWhitespaceElements(),t.nodeName),I=(e,t)=>((e,t)=>{let n=x(e.dom.childNodes,E);return n.length>0&&t<n.length?O(n[t],0):O(e,t)})(E(e),t),R=(e,t,n,r,l,a=!0)=>{let o=a?t(!1):n;for(;o;){let n=B(e,o);if(n||F(e,o)){if(n?r.cef(o):r.boundary(o))break;o=t(!0)}else{if(S(e,o)){if(r.boundary(o))break}else 3===o.nodeType&&r.text(o);if(o===l)break;o=t(!1)}}},M=(e,t,n,r,l)=>{var a;if(S(e,n)||B(e,n)||F(e,n)||"true"===e.getContentEditable(n)&&n.parentNode&&"false"===e.getContentEditableParent(n.parentNode))return;let o=null!==(a=e.getParent(r,e.isBlock))&&void 0!==a?a:e.getRoot(),s=new A(n,o),i=l?s.next.bind(s):s.prev.bind(s);R(e,i,n,{boundary:c,cef:c,text:e=>{l?t.fOffset+=e.length:t.sOffset+=e.length,t.elements.push(E(e))}})},D=(e,t,n,r,l,a=!0)=>{let o=new A(n,t),s=[],i={sOffset:0,fOffset:0,elements:[]};M(e,i,n,t,!1);let d=()=>(i.elements.length>0&&(s.push(i),i={sOffset:0,fOffset:0,elements:[]}),!1);return R(e,o.next.bind(o),n,{boundary:d,cef:e=>(d(),l&&s.push(...l.cef(e)),!1),text:e=>{i.elements.push(E(e)),l&&l.text(e,i)}},r,a),r&&M(e,i,r,t,!0),d(),s},P=(e,t)=>{let n=I(t.startContainer,t.startOffset),r=n.element.dom,l=I(t.endContainer,t.endOffset),a=l.element.dom;return D(e,t.commonAncestorContainer,r,a,{text:(e,t)=>{e===a?t.fOffset+=e.length-l.offset:e===r&&(t.sOffset+=n.offset)},cef:t=>((e,t)=>{let n=f.call(e,0);return n.sort((e,t)=>{var n,r,l;return(n=e.elements[0].dom,r=t.elements[0].dom,l=Node.DOCUMENT_POSITION_PRECEDING,0!=(n.compareDocumentPosition(r)&l))?1:-1}),n})(v(((e,t)=>{let n=void 0===t?document:t.dom;return 1!==n.nodeType&&9!==n.nodeType&&11!==n.nodeType||0===n.childElementCount?[]:x(n.querySelectorAll(e),E)})("*[contenteditable=true]",E(t)),t=>{let n=t.dom;return D(e,n,n)}))},!1)},W=(e,t)=>t.collapsed?[]:P(e,t),$=(e,t)=>{let n=e.createRng();return n.selectNode(t),W(e,n)},V=(e,t)=>v(t,t=>{let n=t.elements,r=x(n,k).join(""),l=((e,t,n=0,r=e.length)=>{let l;let a=t.regex;a.lastIndex=n;let o=[];for(;l=a.exec(e);){let e=l[t.matchIndex],n=l.index+l[0].indexOf(e),s=n+e.length;if(s>r)break;o.push({start:n,finish:s}),a.lastIndex=s}return o})(r,e,t.sOffset,r.length-t.fOffset);return((e,t)=>{var n,r;let l=(n=(e,n)=>{let r=k(n),l=e.last,a=l+r.length,o=v(t,(e,t)=>e.start<a&&e.finish>l?[{element:n,start:Math.max(l,e.start)-l,finish:Math.min(a,e.finish)-l,matchId:t}]:[]);return{results:e.results.concat(o),last:a}},r={results:[],last:0},y(e,(e,t)=>{r=n(r,e)}),r).results;return((e,t)=>{if(0===e.length)return[];{let n=t(e[0]),r=[],l=[];for(let a=0,o=e.length;a<o;a++){let o=e[a],s=t(o);s!==n&&(r.push(l),l=[]),n=s,l.push(o)}return 0!==l.length&&r.push(l),r}})(l,e=>e.matchId)})(n,l)}),j=(e,t)=>{b(e,(e,n)=>{b(e,e=>{let r=E(t.cloneNode(!1));((e,t,n)=>{if(!(l(n)||o(n)||s(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),Error("Attribute value was not simple");e.setAttribute(t,n+"")})(r.dom,"data-mce-index",n);let a=e.element.dom;if(a.length===e.finish&&0===e.start)N(e.element,r);else{a.length!==e.finish&&a.splitText(e.finish);let t=a.splitText(e.start);N(E(t),r)}})})},z=e=>e.getAttribute("data-mce-index"),U=(e,t,n,r)=>{let l=e.dom.create("span",{"data-mce-bogus":1});l.className="mce-match-marker";let a=e.getBody();return Y(e,t,!1),r?((e,t,n,r)=>{let l=n.getBookmark(),a=e.select("td[data-mce-selected],th[data-mce-selected]"),o=a.length>0?v(a,t=>$(e,t)):W(e,n.getRng()),s=V(t,o);return j(s,r),n.moveToBookmark(l),s.length})(e.dom,n,e.selection,l):((e,t,n,r)=>{let l=$(e,n),a=V(t,l);return j(a,r),a.length})(e.dom,n,a,l)},_=e=>{var t;let n=e.parentNode;e.firstChild&&n.insertBefore(e.firstChild,e),null===(t=e.parentNode)||void 0===t||t.removeChild(e)},q=(e,t)=>{let n=[],r=g.toArray(e.getBody().getElementsByTagName("span"));if(r.length)for(let e=0;e<r.length;e++){let l=z(r[e]);null!==l&&l.length&&l===t.toString()&&n.push(r[e])}return n},G=(e,t,n)=>{let r=t.get(),l=r.index,a=e.dom;n?l+1===r.count?l=0:l++:l-1==-1?l=r.count-1:l--,a.removeClass(q(e,r.index),"mce-match-marker-selected");let o=q(e,l);return o.length?(a.addClass(q(e,l),"mce-match-marker-selected"),e.selection.scrollIntoView(o[0]),l):-1},K=(e,t)=>{let n=t.parentNode;e.remove(t),n&&e.isEmpty(n)&&e.remove(n)},H=(e,t,n,r,l,a)=>{let o=e.selection,s=((e,t)=>{let n="("+e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&").replace(/\s/g,"[^\\S\\r\\n\\uFEFF]")+")";return t?`(?:^|\\s|${u()})`+n+`(?=$|\\s|${u()})`:n})(n,l),i=o.isForward(),d={regex:new RegExp(s,r?"g":"gi"),matchIndex:1},c=U(e,t,d,a);if(m.browser.isSafari()&&o.setRng(o.getRng(),i),c){let o=G(e,t,!0);t.set({index:o,count:c,text:n,matchCase:r,wholeWord:l,inSelection:a})}return c},J=(e,t)=>{let n=G(e,t,!0);t.set({...t.get(),index:n})},L=(e,t)=>{let n=G(e,t,!1);t.set({...t.get(),index:n})},Q=e=>{let t=z(e);return null!==t&&t.length>0},X=(e,t,n,r,l)=>{let a=t.get(),o=a.index,s,i=o;r=!1!==r;let d=e.getBody(),c=g.grep(g.toArray(d.getElementsByTagName("span")),Q);for(let t=0;t<c.length;t++){let d=z(c[t]),u=s=parseInt(d,10);if(l||u===a.index){for(n.length?(c[t].innerText=n,_(c[t])):K(e.dom,c[t]);c[++t];){if((u=parseInt(z(c[t]),10))!==s){t--;break}K(e.dom,c[t])}r&&i--}else s>o&&c[t].setAttribute("data-mce-index",String(s-1))}return t.set({...a,count:l?0:a.count-1,index:i}),r?J(e,t):L(e,t),!l&&t.get().count>0},Y=(e,t,n)=>{let r,l;let a=t.get(),o=g.toArray(e.getBody().getElementsByTagName("span"));for(let e=0;e<o.length;e++){let t=z(o[e]);null!==t&&t.length&&(t===a.index.toString()&&(r||(r=o[e].firstChild),l=o[e].firstChild),_(o[e]))}if(t.set({...a,index:-1,count:0,text:""}),r&&l){let t=e.dom.createRng();return t.setStart(r,0),t.setEnd(l,l.data.length),!1!==n&&e.selection.setRng(t),t}},Z=(t,n)=>{let r=(()=>{let t=(t=>{let n=e(h.none()),r=()=>n.get().each(t);return{clear:()=>{r(),n.set(h.none())},isSet:()=>n.get().isSome(),get:()=>n.get(),set:e=>{r(),n.set(h.some(e))}}})(i);return{...t,on:e=>t.get().each(e)}})();t.undoManager.add();let l=g.trim(t.selection.getContent({format:"text"})),a=e=>{e.setEnabled("next",n.get().count>1),e.setEnabled("prev",n.get().count>1)},o=(e,t)=>{y(["replace","replaceall","prev","next"],n=>e.setEnabled(n,!t))},s=(e,t)=>{t.redial(b(e,t.getData()))},d=(e,t)=>{m.browser.isSafari()&&m.deviceType.isTouch()&&("find"===t||"replace"===t||"replaceall"===t)&&e.focus(t)},c=e=>{Y(t,n,!1),o(e,!0),a(e)},u=e=>{let r=e.getData(),l=n.get();if(r.findtext.length){if(l.text===r.findtext&&l.matchCase===r.matchcase&&l.wholeWord===r.wholewords)J(t,n);else{let l=H(t,n,r.findtext,r.matchcase,r.wholewords,r.inselection);l<=0&&s(!0,e),o(e,0===l)}a(e)}else c(e)},f=n.get(),p={findtext:l,replacetext:"",wholewords:f.wholeWord,matchcase:f.matchCase,inselection:f.inSelection},x=e=>{let t=[{type:"bar",items:[{type:"input",name:"findtext",placeholder:"Find",maximized:!0,inputMode:"search"},{type:"button",name:"prev",text:"Previous",icon:"action-prev",enabled:!1,borderless:!0},{type:"button",name:"next",text:"Next",icon:"action-next",enabled:!1,borderless:!0}]},{type:"input",name:"replacetext",placeholder:"Replace with",inputMode:"search"}];return e&&t.push({type:"alertbanner",level:"error",text:"Could not find the specified string.",icon:"warning"}),t},b=(e,r)=>({title:"Find and Replace",size:"normal",body:{type:"panel",items:x(e)},buttons:[{type:"menu",name:"options",icon:"preferences",tooltip:"Preferences",align:"start",items:[{type:"togglemenuitem",name:"matchcase",text:"Match case"},{type:"togglemenuitem",name:"wholewords",text:"Find whole words only"},{type:"togglemenuitem",name:"inselection",text:"Find in selection"}]},{type:"custom",name:"find",text:"Find",primary:!0},{type:"custom",name:"replace",text:"Replace",enabled:!1},{type:"custom",name:"replaceall",text:"Replace all",enabled:!1}],initialData:r,onChange:(t,r)=>{e&&s(!1,t),"findtext"===r.name&&n.get().count>0&&c(t)},onAction:(e,r)=>{let l=e.getData();switch(r.name){case"find":u(e);break;case"replace":X(t,n,l.replacetext)?a(e):c(e);break;case"replaceall":X(t,n,l.replacetext,!0,!0),c(e);break;case"prev":L(t,n),a(e);break;case"next":J(t,n),a(e);break;case"matchcase":case"wholewords":case"inselection":s(!1,e),(e=>{let t=e.getData(),r=n.get();n.set({...r,matchCase:t.matchcase,wholeWord:t.wholewords,inSelection:t.inselection})})(e),c(e)}d(e,r.name)},onSubmit:e=>{u(e),d(e,"find")},onClose:()=>{t.focus(),Y(t,n),t.undoManager.add()}});r.set(t.windowManager.open(b(!1,p),{inline:"toolbar"}))},ee=(e,t)=>()=>{Z(e,t)};t.add("searchreplace",t=>{let n=e({index:-1,count:0,text:"",matchCase:!1,wholeWord:!1,inSelection:!1});return((e,t)=>{e.addCommand("SearchReplace",()=>{Z(e,t)})})(t,n),t.ui.registry.addMenuItem("searchreplace",{text:"Find and replace...",shortcut:"Meta+F",onAction:ee(t,n),icon:"search"}),t.ui.registry.addButton("searchreplace",{tooltip:"Find and replace",onAction:ee(t,n),icon:"search"}),t.shortcuts.add("Meta+F","",ee(t,n)),{done:e=>Y(t,n,e),find:(e,r,l,a=!1)=>H(t,n,e,r,l,a),next:()=>J(t,n),prev:()=>L(t,n),replace:(e,r,l)=>X(t,n,e,r,l)}})}();