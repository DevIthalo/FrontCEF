!function(){"use strict";var e=tinymce.util.Tools.resolve("tinymce.PluginManager");let t=e=>t=>(e=>{var t,n;let l=typeof e;return null===e?"null":"object"===l&&Array.isArray(e)?"array":"object"===l&&((t=String).prototype.isPrototypeOf(e)||(null===(n=e.constructor)||void 0===n?void 0:n.name)===t.name)?"string":l})(t)===e,n=e=>t=>typeof t===e,l=t("string"),r=t("object"),o=t("array"),i=e=>null===e,a=n("boolean"),s=e=>null!=e,u=n("function"),c=(e,t)=>{if(o(e)){for(let n=0,l=e.length;n<l;++n)if(!t(e[n]))return!1;return!0}return!1},g=()=>{},d=(e,t)=>e===t;class m{constructor(e,t){this.tag=e,this.value=t}static some(e){return new m(!0,e)}static none(){return m.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?m.some(e(this.value)):m.none()}bind(e){return this.tag?e(this.value):m.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:m.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw Error(null!=e?e:"Called getOrDie on None")}static from(e){return s(e)?m.some(e):m.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}m.singletonNone=new m(!1);let h=Array.prototype.indexOf,f=Array.prototype.push,p=e=>{let t=[];for(let n=0,l=e.length;n<l;++n){if(!o(e[n]))throw Error("Arr.flatten item "+n+" was not an array, input: "+e);f.apply(t,e[n])}return t},k=(e,t)=>{for(let n=0;n<e.length;n++){let l=t(e[n],n);if(l.isSome())return l}return m.none()},v=(e,t,n=d)=>e.exists(e=>n(e,t)),y=e=>{let t=[],n=e=>{t.push(e)};for(let t=0;t<e.length;t++)e[t].each(n);return t},x=(e,t)=>e?m.some(t):m.none(),b=e=>t=>t.options.get(e),_=b("link_assume_external_targets"),w=b("link_context_toolbar"),C=b("link_list"),O=b("link_default_target"),N=b("link_default_protocol"),A=b("link_target_list"),S=b("link_rel_list"),E=b("link_class_list"),T=b("link_title"),R=b("allow_unsafe_link_target"),P=b("link_quicklink");var L=tinymce.util.Tools.resolve("tinymce.util.Tools");let M=e=>l(e.value)?e.value:"",D=(e,t)=>{let n=[];return L.each(e,e=>{let r=l(e.text)?e.text:l(e.title)?e.title:"";if(void 0!==e.menu){let l=D(e.menu,t);n.push({text:r,items:l})}else{let l=t(e);n.push({text:r,value:l})}}),n},B=(e=M)=>t=>m.from(t).map(t=>D(t,e)),I=e=>B(M)(e),j=(e,t)=>n=>({name:e,type:"listbox",label:t,items:n}),K=Object.keys,U=Object.hasOwnProperty,q=(e,t)=>U.call(e,t);var F=tinymce.util.Tools.resolve("tinymce.dom.TreeWalker"),V=tinymce.util.Tools.resolve("tinymce.util.URI");let $=e=>s(e)&&"a"===e.nodeName.toLowerCase(),z=e=>$(e)&&!!J(e),G=(e,t)=>{if(e.collapsed)return[];{let n=e.cloneContents(),l=n.firstChild,r=new F(l,n),o=[],i=l;do t(i)&&o.push(i);while(i=r.next());return o}},H=e=>/^\w+:/i.test(e),J=e=>{var t,n;return null!==(n=null!==(t=e.getAttribute("data-mce-href"))&&void 0!==t?t:e.getAttribute("href"))&&void 0!==n?n:""},W=(e,t)=>{var n;let l=["noopener"],r=e?e.split(/\s+/):[],o=e=>e.filter(e=>-1===L.inArray(l,e)),i=t?(n=o(n=r)).length>0?n.concat(l):l:o(r);return i.length>0?L.trim(i.sort().join(" ")):""},Q=(e,t)=>el(t=t||Z(e.selection.getRng())[0]||e.selection.getNode())?m.from(e.dom.select("a[href]",t)[0]):m.from(e.dom.getParent(t,"a[href]")),X=(e,t)=>Q(e,t).isSome(),Y=(e,t)=>t.fold(()=>e.getContent({format:"text"}),e=>e.innerText||e.textContent||"").replace(/\uFEFF/g,""),Z=e=>G(e,z),ee=e=>L.grep(e,z),et=e=>ee(e).length>0,en=e=>{let t=e.schema.getTextInlineElements();if(Q(e).exists(e=>e.hasAttribute("data-mce-block")))return!1;let n=e.selection.getRng();return!!n.collapsed||0===G(n,e=>1===e.nodeType&&!$(e)&&!q(t,e.nodeName.toLowerCase())).length},el=e=>s(e)&&"FIGURE"===e.nodeName&&/\bimage\b/i.test(e.className),er=(e,t,n)=>{var l,r;let o=e.selection.getNode(),i=Q(e,o),a=((e,t)=>{var n,l;let r={...t};if(0===S(e).length&&!R(e)){let e=W(r.rel,"_blank"===r.target);r.rel=e||null}return m.from(r.target).isNone()&&!1===A(e)&&(r.target=O(e)),r.href=(n=r.href,"http"!==(l=_(e))&&"https"!==l||H(n)?n:l+"://"+n),r})(e,(l=(e,t)=>(n[t].each(n=>{e[t]=n.length>0?n:null}),e),r={href:n.href},((e,t)=>{for(let n=0,l=e.length;n<l;n++)t(e[n],n)})(["title","rel","class","target"],(e,t)=>{r=l(r,e)}),r));e.undoManager.transact(()=>{n.href===t.href&&t.attach(),i.fold(()=>{((e,t,n,l)=>{let r=e.dom;el(t)?eu(r,t,l):n.fold(()=>{e.execCommand("mceInsertLink",!1,l)},t=>{e.insertContent(r.createHTML("a",l,r.encode(t)))})})(e,o,n.text,a)},t=>{e.focus(),n.text.each(e=>{q(t,"innerText")?t.innerText=e:t.textContent=e}),e.dom.setAttribs(t,a),e.selection.select(t)})})},eo=e=>{let{class:t,href:n,rel:l,target:r,text:o,title:a}=e;return((e,t)=>{var n,l;let r={};return n=(e,t)=>!1===i(e),l=(e,t)=>{r[t]=e},((e,t)=>{let n=K(e);for(let l=0,r=n.length;l<r;l++){let r=n[l];t(e[r],r)}})(e,(e,t)=>{(n(e,t)?l:g)(e,t)}),r})({class:t.getOrNull(),href:n,rel:l.getOrNull(),target:r.getOrNull(),text:o.getOrNull(),title:a.getOrNull()})},ei=(e,t,n)=>{let l=((e,t)=>{let n=e.options.get,l={allow_html_data_urls:n("allow_html_data_urls"),allow_script_urls:n("allow_script_urls"),allow_svg_data_urls:n("allow_svg_data_urls")},r=t.href;return{...t,href:V.isDomSafe(r,"a",l)?r:""}})(e,n);e.hasPlugin("rtc",!0)?e.execCommand("createlink",!1,eo(l)):er(e,t,l)},ea=e=>{e.hasPlugin("rtc",!0)?e.execCommand("unlink"):(e=>{e.undoManager.transact(()=>{let t=e.selection.getNode();el(t)?es(e,t):(e=>{let t=e.dom,n=e.selection,l=n.getBookmark(),r=n.getRng().cloneRange(),o=t.getParent(r.startContainer,"a[href]",e.getBody()),i=t.getParent(r.endContainer,"a[href]",e.getBody());o&&r.setStartBefore(o),i&&r.setEndAfter(i),n.setRng(r),e.execCommand("unlink"),n.moveToBookmark(l)})(e),e.focus()})})(e)},es=(e,t)=>{var n;let l=e.dom.select("img",t)[0];if(l){let r=e.dom.getParents(l,"a[href]",t)[0];r&&(null===(n=r.parentNode)||void 0===n||n.insertBefore(l,r),e.dom.remove(r))}},eu=(e,t,n)=>{var l;let r=e.select("img",t)[0];if(r){let t=e.create("a",n);null===(l=r.parentNode)||void 0===l||l.insertBefore(t,r),t.appendChild(r)}},ec=(e,t)=>k(t,t=>{var n;return q(t,n="items")&&void 0!==t[n]&&null!==t[n]?ec(e,t.items):x(t.value===e,t)}),eg=(e,t)=>{let n={text:e.text,title:e.title},l=(e,l)=>{let r=("link"===l?t.link:"anchor"===l?t.anchor:m.none()).getOr([]);return((e,t,n,l)=>{let r=l[t],o=e.length>0;return void 0!==r?ec(r,n).map(t=>({url:{value:t.value,meta:{text:o?e:t.text,attach:g}},text:o?e:t.text})):m.none()})(n.text,l,r,e)};return{onChange:(e,t)=>{let r=t.name;return"url"===r?(e=>{var t,l,r,o;let i=(t=e.url,x(n.text.length<=0,m.from(null===(l=t.meta)||void 0===l?void 0:l.text).getOr(t.value))),a=(r=e.url,x(n.title.length<=0,m.from(null===(o=r.meta)||void 0===o?void 0:o.title).getOr("")));return i.isSome()||a.isSome()?m.some({...i.map(e=>({text:e})).getOr({}),...a.map(e=>({title:e})).getOr({})}):m.none()})(e()):h.call(["anchor","link"],r)>-1?l(e(),r):(("text"===r||"title"===r)&&(n[r]=e()[r]),m.none())}}};var ed=tinymce.util.Tools.resolve("tinymce.util.Delay");let em=e=>{let t=e.href;return t.indexOf("@")>0&&-1===t.indexOf("/")&&-1===t.indexOf("mailto:")?m.some({message:"The URL you entered seems to be an email address. Do you want to add the required mailto: prefix?",preprocess:e=>({...e,href:"mailto:"+t})}):m.none()},eh=(e,t)=>n=>{let l=n.href;return 1===e&&!H(l)||0===e&&/^\s*www(\.|\d\.)/i.test(l)?m.some({message:`The URL you entered seems to be an external link. Do you want to add the required ${t}:// prefix?`,preprocess:e=>({...e,href:t+"://"+l})}):m.none()},ef=e=>{let t=e.dom.select("a:not([href])"),n=p(((e,t)=>{let n=e.length,l=Array(n);for(let r=0;r<n;r++){let n=e[r];l[r]=t(n,r)}return l})(t,e=>{let t=e.name||e.id;return t?[{text:t,value:"#"+t}]:[]}));return n.length>0?m.some([{text:"None",value:""}].concat(n)):m.none()},ep=e=>{let t=E(e);return t.length>0?I(t):m.none()},ek=e=>{try{return m.some(JSON.parse(e))}catch(e){return m.none()}},ev=(e,t)=>{let n=S(e);if(n.length>0){let l=v(t,"_blank");return(!1===R(e)?B(e=>W(M(e),l)):I)(n)}return m.none()},ey=[{text:"Current window",value:""},{text:"New window",value:"_blank"}],ex=e=>{let t=A(e);return o(t)?I(t).orThunk(()=>m.some(ey)):!1===t?m.none():m.some(ey)},eb=(e,t,n)=>{let l=e.getAttrib(t,n);return null!==l&&l.length>0?m.some(l):m.none()},e_=(e,t)=>(e=>{let t=t=>e.convertURL(t.value||t.url||"","href"),n=C(e);return new Promise(e=>{l(n)?fetch(n).then(e=>e.ok?e.text().then(ek):Promise.reject()).then(e,()=>e(m.none())):u(n)?n(t=>e(m.some(t))):e(m.from(n))}).then(e=>e.bind(B(t)).map(e=>e.length>0?[{text:"None",value:""}].concat(e):e))})(e).then(n=>{let l=((e,t)=>{let n=e.dom,l=en(e)?m.some(Y(e.selection,t)):m.none(),r=t.bind(e=>m.from(n.getAttrib(e,"href"))),o=t.bind(e=>m.from(n.getAttrib(e,"target"))),i=t.bind(e=>eb(n,e,"rel")),a=t.bind(e=>eb(n,e,"class"));return{url:r,text:l,title:t.bind(e=>eb(n,e,"title")),target:o,rel:i,linkClass:a}})(e,t);return{anchor:l,catalogs:{targets:ex(e),rels:ev(e,l.target),classes:ep(e),anchor:ef(e),link:n},optNode:t,flags:{titleEnabled:T(e)}}}),ew=e=>{let t=(e=>{let t=Q(e);return e_(e,t)})(e);t.then(t=>((e,t,n)=>{let l=e.anchor.text.map(()=>({name:"text",type:"input",label:"Text to display"})).toArray(),r=e.flags.titleEnabled?[{name:"title",type:"input",label:"Title"}]:[],o=((e,t)=>{let n=e.anchor,l=n.url.getOr("");return{url:{value:l,meta:{original:{value:l}}},text:n.text.getOr(""),title:n.title.getOr(""),anchor:l,link:l,rel:n.rel.getOr(""),target:n.target.or(t).getOr(""),linkClass:n.linkClass.getOr("")}})(e,m.from(O(n))),i=e.catalogs,a=eg(o,i);return{title:"Insert/Edit Link",size:"normal",body:{type:"panel",items:p([[{name:"url",type:"urlinput",filetype:"file",label:"URL"}],l,r,y([i.anchor.map(j("anchor","Anchors")),i.rels.map(j("rel","Rel")),i.targets.map(j("target","Open link in...")),i.link.map(j("link","Link list")),i.classes.map(j("linkClass","Class"))])])},buttons:[{type:"cancel",name:"cancel",text:"Cancel"},{type:"submit",name:"save",text:"Save",primary:!0}],initialData:o,onChange:(e,{name:t})=>{a.onChange(e.getData,{name:t}).each(t=>{e.setData(t)})},onSubmit:t}})(t,n=>{let l=n.getData();if(!l.url.value)return ea(e),void n.close();let r=e=>m.from(l[e]).filter(n=>!v(t.anchor[e],n)),o={href:l.url.value,text:r("text"),target:r("target"),rel:r("rel"),class:r("linkClass"),title:r("title")},i={href:l.url.value,attach:void 0!==l.url.meta&&l.url.meta.attach?l.url.meta.attach:g};k([em,eh(_(e),N(e))],e=>e(o)).fold(()=>Promise.resolve(o),t=>new Promise(n=>{((e,t,n)=>{let l=e.selection.getRng();ed.setEditorTimeout(e,()=>{e.windowManager.confirm(t,t=>{e.selection.setRng(l),n(t)})})})(e,t.message,e=>{n(e?t.preprocess(o):o)})})).then(t=>{ei(e,i,t)}),n.close()},e)).then(t=>{e.windowManager.open(t)})};var eC=tinymce.util.Tools.resolve("tinymce.util.VK");let eO=(e,t)=>e.dom.getParent(t,"a[href]"),eN=e=>eO(e,e.selection.getStart()),eA=(e,t)=>{if(t){let n=J(t);if(/^#/.test(n)){let t=e.dom.select(n);t.length&&e.selection.scrollIntoView(t[0],!0)}else(e=>{let t=document.createElement("a");t.target="_blank",t.href=e,t.rel="noreferrer noopener";let n=document.createEvent("MouseEvents");n.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),document.body.appendChild(t),t.dispatchEvent(n),document.body.removeChild(t)})(t.href)}},eS=e=>()=>{e.execCommand("mceLink",!1,{dialog:!0})},eE=e=>()=>{eA(e,eN(e))},eT=(e,t)=>(e.on("NodeChange",t),()=>e.off("NodeChange",t)),eR=e=>t=>{let n=()=>{t.setActive(!e.mode.isReadOnly()&&X(e,e.selection.getNode())),t.setEnabled(e.selection.isEditable())};return n(),eT(e,n)},eP=e=>t=>{let n=()=>{t.setEnabled(e.selection.isEditable())};return n(),eT(e,n)},eL=e=>t=>{let n=()=>t.setEnabled(1===(e.selection.isCollapsed()?ee(e.dom.getParents(e.selection.getStart())):Z(e.selection.getRng())).length);return n(),eT(e,n)},eM=e=>t=>{let n=e.dom.getParents(e.selection.getStart()),l=n=>{t.setEnabled((et(n)||Z(e.selection.getRng()).length>0)&&e.selection.isEditable())};return l(n),eT(e,e=>l(e.parents))};e.add("link",e=>{(e=>{let t=e.options.register;t("link_assume_external_targets",{processor:e=>{let t=l(e)||a(e);return t?!0===e?{value:1,valid:t}:"http"===e||"https"===e?{value:e,valid:t}:{value:0,valid:t}:{valid:!1,message:"Must be a string or a boolean."}},default:!1}),t("link_context_toolbar",{processor:"boolean",default:!1}),t("link_list",{processor:e=>l(e)||u(e)||c(e,r)}),t("link_default_target",{processor:"string"}),t("link_default_protocol",{processor:"string",default:"https"}),t("link_target_list",{processor:e=>a(e)||c(e,r),default:!0}),t("link_rel_list",{processor:"object[]",default:[]}),t("link_class_list",{processor:"object[]",default:[]}),t("link_title",{processor:"boolean",default:!0}),t("allow_unsafe_link_target",{processor:"boolean",default:!1}),t("link_quicklink",{processor:"boolean",default:!1})})(e),e.ui.registry.addToggleButton("link",{icon:"link",tooltip:"Insert/edit link",onAction:eS(e),onSetup:eR(e)}),e.ui.registry.addButton("openlink",{icon:"new-tab",tooltip:"Open link",onAction:eE(e),onSetup:eL(e)}),e.ui.registry.addButton("unlink",{icon:"unlink",tooltip:"Remove link",onAction:()=>ea(e),onSetup:eM(e)}),e.ui.registry.addMenuItem("openlink",{text:"Open link",icon:"new-tab",onAction:eE(e),onSetup:eL(e)}),e.ui.registry.addMenuItem("link",{icon:"link",text:"Link...",shortcut:"Meta+K",onSetup:eP(e),onAction:eS(e)}),e.ui.registry.addMenuItem("unlink",{icon:"unlink",text:"Remove link",onAction:()=>ea(e),onSetup:eM(e)}),(e=>{e.ui.registry.addContextMenu("link",{update:t=>e.dom.isEditable(t)?et(e.dom.getParents(t,"a"))?"link unlink openlink":"link":""})})(e),(e=>{let t=t=>{let n=e.selection.getNode();return t.setEnabled(X(e,n)),g};e.ui.registry.addContextForm("quicklink",{launch:{type:"contextformtogglebutton",icon:"link",tooltip:"Link",onSetup:eR(e)},label:"Link",predicate:t=>w(e)&&X(e,t),initValue:()=>Q(e).fold(()=>"",J),commands:[{type:"contextformtogglebutton",icon:"link",tooltip:"Link",primary:!0,onSetup:t=>{let n=e.selection.getNode();return t.setActive(X(e,n)),eR(e)(t)},onAction:t=>{let n=t.getValue(),l=(t=>{let n=Q(e),l=en(e);if(n.isNone()&&l){let l=Y(e.selection,n);return x(0===l.length,t)}return m.none()})(n);ei(e,{href:n,attach:g},{href:n,text:l,title:m.none(),rel:m.none(),target:m.none(),class:m.none()}),(e=>{e.selection.collapse(!1)})(e),t.hide()}},{type:"contextformbutton",icon:"unlink",tooltip:"Remove link",onSetup:t,onAction:t=>{ea(e),t.hide()}},{type:"contextformbutton",icon:"new-tab",tooltip:"Open link",onSetup:t,onAction:t=>{eE(e)(),t.hide()}}]})})(e),e.on("click",t=>{let n=eO(e,t.target);n&&eC.metaKeyPressed(t)&&(t.preventDefault(),eA(e,n))}),e.on("keydown",t=>{if(!t.isDefaultPrevented()&&13===t.keyCode&&!0===t.altKey&&!1===t.shiftKey&&!1===t.ctrlKey&&!1===t.metaKey){let n=eN(e);n&&(t.preventDefault(),eA(e,n))}}),(e=>{e.addCommand("mceLink",(t,n)=>{!0!==(null==n?void 0:n.dialog)&&P(e)?e.dispatch("contexttoolbar-show",{toolbarKey:"quicklink"}):ew(e)})})(e),(e=>{e.addShortcut("Meta+K","",()=>{e.execCommand("mceLink")})})(e)})}();